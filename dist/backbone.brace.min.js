/*! 
 *  Backbone Brace - 2013-11-07 
 *  Copyright 2013 Atlassian Software Systems Pty Ltd
 *  Licensed under the Apache License, Version 2.0
 */
!function(){function a(a){return q.isArray(a)?q.reduce(a,function(a,b){return a[b]=null,a},{}):a}function b(a,e){if(!a||null==e)return e;if(a===String&&q.isString(e))return e;if(a===Number&&q.isNumber(e))return e;if(a===Boolean&&q.isBoolean(e))return e;if("string"==typeof a||a instanceof String){if(typeof e!=""+a)throw"The typeof "+e+" is "+typeof e+" but expected it to be "+a;return e}if(q.isArray(a)||a===Array){if(!d(e))throw"Array type expected, but nonnull, non-Array value provided.";return a!==Array&&a[0]?q.map(e,q.bind(b,null,a[0])):e}if("function"!=typeof a)throw"Invalid expected type "+a+". Should be falsy, String, Array, Backbone.Collection constructor, or function.";return e instanceof a?e:c(a)?new a(b([a.model],e)):new a(e)}function c(a,b){return a&&(a.__super__ instanceof(b||r.Collection)||a.__super__===(b||r.Collection).prototype||a===(b||r.Collection))}function d(a){return q.has(a,"length")&&!(a instanceof String||q.has({string:1,"function":1},typeof a)||a instanceof r.Collection)}function e(a,b){var c={};return q.each(a,function(a,d){if(b[d]&&!f(a,b[d])){if(!a||f(b[d],a))return;throw d+" has conflicted type descriptors."}c[d]=a}),c}function f(a,b){return b&&b!==a?a&&"string"!=typeof a?a instanceof Array?b===Array||b instanceof Array&&f(a[0],b[0]):"function"!=typeof b?!1:c(b)?c(a,b):a.prototype instanceof b:!1:!0}function g(a){return q.isObject(a)?q.reduce(a,function(a,b,c){return b&&q.isFunction(b.toJSON)?a[c]=b.toJSON():q.isArray(b)&&(a[c]=q.map(b,function(a){return a&&q.isFunction(a.toJSON)?a.toJSON():a})),a},a):a}function h(a){return function(){var b=a.call(this);return g(b)}}function i(b){return function c(d,e){var f,g,i=q.extend({},d);return d&&d.mixins&&(g=d.mixins,delete i.mixins),f=b.call(this,i,e),this.prototype.namedEvents&&n.Mixins.applyMixin(f,{namedEvents:this.prototype.namedEvents}),this.prototype.namedAttributes&&n.Mixins.applyMixin(f,{namedAttributes:this.prototype.namedAttributes}),g&&q.each(d.mixins,function(a){n.Mixins.applyMixin(f,a)}),f.prototype.namedEvents&&n.Mixins.applyMixin(f,n.EventsMixinCreator.create(f.prototype.namedEvents)),f.prototype.namedAttributes&&(f.prototype.namedAttributes=a(f.prototype.namedAttributes),n.Mixins.applyMixin(f,n.AttributesMixinCreator.create(f.prototype.namedAttributes,f.prototype.idAttribute))),f.prototype.toJSON&&(f.prototype.toJSON=h(f.prototype.toJSON)),f.extend=c,f}}function j(a,c){var d=a.prototype,e=c.prototype,f=d.set;e.set=function(a,c,d){var e,g=this.namedAttributes;if(!g||null==a)return f.apply(this,arguments);q.isObject(a)?(e=q.clone(a),d=c):(e={},e[a]=c);for(var h in e)if(q.has(e,h)){if(!q.has(g,h))throw"Attribute '"+h+"' does not exist";e[h]=b(g[h],e[h])}return f.call(this,e,d)};var g=d.get;e.get=function(a){if(this.namedAttributes&&!q.has(this.namedAttributes,a))throw"Attribute '"+a+"' does not exist";return g.apply(this,arguments)}}function k(a,b){var c=a.prototype,d=b.prototype,e=c.parse;d.parse=function(a,b){return q.pick(e(a,b),q.keys(this.namedAttributes))}}function l(a){var b=a.extend(),c=a.extend;return b.extend=i(c),b}function m(a){var b=l(a);return j(a,b),k(a,b),b}var n,o=this,p=o.Brace;n="undefined"!=typeof exports?exports:o.Brace={},n.noConflict=function(){return o.Brace=p,this};var q=o._;q||"undefined"==typeof require||(q=require("underscore"));var r=o.Backbone;r||"undefined"==typeof require||(r=require("backbone")),n.Mixins={createMethodName:function(a,b){return a+b.charAt(0).toUpperCase()+b.substr(1)},applyMixin:function(b,c){q.forEach(q.keys(c),function(d){var f=b.prototype;if("initialize"===d){var g=f.initialize;return f.initialize=function(){g&&g.apply(this,arguments),c.initialize.apply(this,arguments)},void 0}if("validate"===d){var h=f.validate;return f.validate=function(){if(h){var a=h.apply(this,arguments);if(a)return a}return c.validate.apply(this,arguments)},void 0}if("defaults"!==d){if("namedAttributes"===d){var i=a(f.namedAttributes)||{},j=a(c[d]);return f.namedAttributes=q.extend(i,e(j,i)),void 0}if("namedEvents"===d){if(!q.isArray(c[d]))throw"Expects events member on mixin to be an array";return f.namedEvents||(f.namedEvents=[]),f.namedEvents=q.uniq(f.namedEvents.concat(c[d])),void 0}if(f.hasOwnProperty(d))throw"Mixin error: class already has property '"+d+"' defined";f[d]=c[d]}else{var k=f.defaults||(f.defaults={}),l=c[d];for(var m in l){if(k.hasOwnProperty(m))throw"Mixin error: class already has default '"+m+"' defined";k[m]=l[m]}}},this)}},n.AttributesMixinCreator={create:function(a,b){var c={};if(a||(a={}),q.has(a,"id")||(a.id=null),q.each(a,function(a,b){var d=n.Mixins.createMethodName("set",b);c[d]=function(a,c){return this.set(b,a,c)};var e=n.Mixins.createMethodName("get",b);c[e]=function(){return this.get(b)}}),"string"==typeof b&&"undefined"!=typeof a[b]&&"id"!==b){a.id=a[b];var d=n.Mixins.createMethodName("get",b),e=n.Mixins.createMethodName("set",b);c.getId=function(){return this[d]()},c.setId=function(a,b){return this[e](a,b)}}return c},ensureType:b},n.EventsMixinCreator={create:function(a){var b={},c=function(a){var c=n.Mixins.createMethodName("on",a);b[c]=function(){return this.on.apply(this,[a].concat(q.toArray(arguments)))};var d=n.Mixins.createMethodName("trigger",a);b[d]=function(){return this.trigger.apply(this,[a].concat(q.toArray(arguments)))}};return q.each(a,q.bind(c,this)),b}},n.Model=m(r.Model),n.Collection=l(r.Collection),n.View=l(r.View),n.Router=l(r.Router);var s=function(){this.initialize.apply(this,arguments)};q.extend(s.prototype,r.Events,{initialize:function(){}}),s.extend=r.Model.extend,n.Evented=l(s)}();